#textdomain wesnoth-To_Lands_Unknown
[scenario]

  id=13_The_Great_Desert
  next_scenario=14_Far_North
  name= _ "The Great Desert"
  map_data="{~add-ons/To_Lands_Unknown/maps/13_Great_Desert.map}"
  turns=-1
  victory_when_enemies_defeated=no
 
  #{DEFAULT_SCHEDULE}
  {MORNING}
  {SCENARIO_MUSIC casualties_of_war.ogg}
  {EXTRA_SCENARIO_MUSIC battle.ogg}
  {EXTRA_SCENARIO_MUSIC vengeful.ogg}

[story]  
    [part]
        story= _ "And that is how the first part of our story has ended. Mehir became one of the most powerful men in the land of the Summoners and his destiny was beginning to fulfill." 
    [/part]
    [part]
        story= _ "A few weeks have passed before Mehir explored the palace of Tar-Tabar and met his servants. Under the supervision of old summoning veterans he has learned how to use a Megacircle, a necessary spell for all true Summoner masters. He also learned how to lead his troops in order to make his new army as effective as it was under Tashkar's command.
The mysterious messengers of death that have destroyed Mag-Magar haven't returned." 
    [/part]
    [part]
        background=story/map-m14.jpg
        story= _ "The construction of the Great Circle was continued. It was connected to the portal in Tar-Tabar, and three months later it has returned to the place where it was started - to Mag-Magar. A new stage of construction has begun: the cities of the Trinity were to be connected with Al-Kamija. Also, new, smaller circles were to be made. That time, construction was faster because of the thousands of workers from the capital.
Mehir, like the other leaders of the Trinity, was free to do as he wished, because the outer and biggest circle was finished. But there was still an opportunity to test his new skills in battle." 
    [/part]
    [part]
        story= _ "Some days ago one of the Efreeti revolted against his masters from Sud-Affar and fled to the Great Desert. It won't be anything special, for things like this happen in Al-Kamija once in a while, if not for the fact that this Efreet have convinced other magical creatures to follow him. Now, they wander through the desert and are a real threat to one of cities or even to the capital. Scouts have discovered the location of these corrupted beings. It turned out they are near Tar-Tabar, so Mehir was the one ordered to defeat them."
    [/part]
    [part]
        show_title=yes
        background=story/map-m13.jpg
        {NEW_JOURNEY 317 326}
        {NEW_JOURNEY 333 329}
        {NEW_JOURNEY 351 332}
        {NEW_JOURNEY 372 335}
        {NEW_JOURNEY 391 338}
        {NEW_BATTLE 410 341}
    [/part]
[/story]

{STARTING_VILLAGES_ALL 1}
[side]
    side=1
    controller=human
    team_name=mehirteam
    user_team_name= _ "Mehir"

    type=I8 Ak_SummonerIII
    id=Mehir
    name= _ "Mehir"
    unrenamable=yes
    canrecruit=yes

    recruit=I8 Ak_Summoner,I8 Ak_CamelRider,I8 Ak_CarpetRider,I8 Ak_Elemental_water,I8 Ak_SummonerII,I8 Ak_Rhami,I8 Ak_Elemental_fire,I8 Ak_Jinn,I8 Ak_Dispeller

    {GOLD 400 300 200}
    {INCOME 10 5 2}
    
    {UNIT 1 (I8 Ak_Banisher) () () (placement=leader
    id=Banisher
    name= _ "Leader of the Banishers' Guild")}
[/side]

[side]
    side=2
    controller=ai
    team_name=reficul
    user_team_name= _ "Reficul"

    type=I8 Ak_EfreetiGreat
    id=Reficul
    name= _ "Reficul"
    unrenamable=yes
    canrecruit=yes
    facing=sw
    profile=portraits/reficul.png
    colour=purple

    recruit=I8 Ak_RhamiDatu,I8 Ak_Efreeti,I8 Ak_Rhami,I8 Ak_Jinn,I8 Ak_DharmaRhami

    {GOLD 300 500 1000}
    {INCOME 0 5 10}
    
    [ai]
        aggression=1.0
    [/ai]
[/side]

{LIMIT_CONTEMPORANEOUS_RECRUITS 2 (I8 Ak_DharmaRhami) 5}
{LIMIT_CONTEMPORANEOUS_RECRUITS 2 (I8 Ak_Efreeti) 5}

[side]
    side=4
    controller=ai
    team_name=mehirteam
    user_team_name= _ "Kharos"
    colour=white
    hidden=yes
    no_leader=yes

    recruit=

    {GOLD 300 500 1000}
    {INCOME 10 5 0}
[/side]

[event]
    name=prestart
    {PLACE_HALO "scenery/baldachim.png" 26 3}
[/event]

[event]
    name=start
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "That's the place. I can see his canopy over the dunes."
    [/message]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "Ah, a Summoner! You have come to defeat me, have you?"
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Yes. Today you will leave this world forever and return to the Abyss."
    [/message]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "You must be joking. You cannot... defeat... ME!!!"
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "My liege, He is no common Efreet. As a leader of  the Banishers' Guild in Tar-Tabar, I have seen many things, but this one here is a real pleasure to my eyes. He is a real Great Efreet, full of hatred, the most powerful of all creatures of the Red Abyss."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "That's... fantastic. It was supposed to be easy... My first mission as a leader and the personification of destruction on the horizon... I am not surprised at all that he persuaded so many creatures to follow him. Nevertheless I think we will make it, because now I can use jinns!"
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "I advise you, my liege, not to summon them. They can fall to the will of the Great Efreet and join him, although there is a small chance it won't happen. From my experience I know that some being are always devoted to their masters, but we shouldn't risk it, especially because your jinns are unaccustomed to you, my liege. I also suggest not to use red entities at all, because they are of an evil nature and near this Efreet they will surely revolt against us. Of course this is only advise. You'll do whatever you want, my liege."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "And Rashti? What about her? Can I use her? She's half-good..."
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "...but also half-evil. Her divine abilities could help us a lot, but I would not recommend you to summon her. Of course you can risk - her good half shouldn't rebel..."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "So how should we defeat that thing?"
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Use humans, especially dispellers and banishers, who are skilled in fighting with this kind of magical creatures. Elementals are good too. They cannot think, so it is impossible to delude them. You can also use perfectly good beings such as HoRhamis or Wonderful Jinns - they will never betray us."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Let's get to work. Your advise was very helpful."
    [/message]
    [objectives]
      side=1
      [objective]
        description= _ "Defeat Reficul"
        condition=win
      [/objective]
      [objective]
        description= _ "Death of Mehir"
        condition=lose
      [/objective]
      [objective]
        description= _ "Death of Rashti"
        condition=lose
      [/objective]
    [/objectives]
[/event]

#recall/recruit/advance events
[event]
    name=recall
    first_time_only=no
    [filter]
        side=1
        type=I8 Ak_DharmaRhami,I8 Ak_RhamiDatu
    [/filter]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "Come to me, I call you!"
    [/message]
    [message]
            speaker=unit
            #image="wesnoth-icon.png"
            message= _ "My new Master..."
    [/message]
    {MODIFY_UNIT x,y=$x1,$y1 side 2}
    [fire_event]
        name=speech_red
    [/fire_event]
[/event]

[event]
    name=speech_red
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "My liege! What have I told you?!!"
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Damn! I forgot!"
    [/message]
[/event]

[event]
    name=recall
    first_time_only=no
    [filter]
        side=1
        type=I8 Ak_Rhami,I8 Ak_RhamiKai
    [/filter]
    [fire_event]
        name=speech_blue
    [/fire_event]
[/event]

[event]
    name=recruit
    first_time_only=no
    [filter]
        side=1
        type=I8 Ak_Rhami,I8 Ak_Jinn
    [/filter]
    [fire_event]
        name=speech_blue
    [/fire_event]
[/event]

[event]
    name=speech_blue
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Be careful, my liege. This being can betray us in the least expected moment."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "I'll risk it."
    [/message]
[/event]

[event]
    name=post advance
    first_time_only=no
    [filter]
        side=1
        type=I8 Ak_DharmaRhami,I8 Ak_RhamiDatu,I8 Ak_Efreeti
    [/filter]
    
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "Come to me, I call you!"
    [/message]
    {MODIFY_UNIT (x,y=$x1,$y1) side 2}
    [fire_event]
        name=speech_red
    [/fire_event]
[/event]

#capturing event
[event]
    name=side 2 turn
    first_time_only=no
    {RANDOM 1..4}
    [if]
        [variable]
            name=random
            equals=1
        [/variable]
        [then]
            [if]
                [have_unit]
                    side=1
                    type=I8 Ak_Rhami,I8 Ak_Jinn,I8 Ak_RhamiKai,I8 Ak_Jinn_Great
                [/have_unit]
                [then]
                    [store_unit]
                        [filter]
                            type=I8 Ak_Rhami,I8 Ak_Jinn,I8 Ak_RhamiKai,I8 Ak_Jinn_Great
                            side=1
                        [/filter]
                        variable=captured
                    [/store_unit]
                    {VARIABLE captured[0].side 2}
                    [unstore_unit]
                        variable=captured[0]
                    [/unstore_unit]
                    [message]
                        speaker=Reficul
                        #image="wesnoth-icon.png"
                        message= _ "You belong to ME!"
                    [/message]
                    {SCROLL_TO $captured[0].x $captured[0].y}
                    [delay]
                        time=100
                    [/delay]
                    [message]
                        speaker=Banisher
                        #image="wesnoth-icon.png"
                        message= _ "I have warned you..."
                    [/message]
                [/then]
            [/if]
        [/then]
    [/if]
            
            #Rashti
            [if]
                [have_unit]
                    id=Rashti
                    side=1
                [/have_unit]
                [then]
                    #turn processing
                    {VARIABLE timer $turn_number}
                    {VARIABLE_OP timer add $turn_rashti}
                    [switch]
                        variable=timer
                        [case]
                            value=1
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "Rashti'rhami, the goddess of all Rhamis. You're like me."
                            [/message]
                            [message]
                                speaker=Rashti
                                image="portraits/rashti-ho.png"
                                message= _ "No, I am not."
                            [/message]
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "I will prove it to you soon..."
                            [/message]
                        [/case]
                        [case]
                            value=3
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "Rashti, I know you want to be with me!"
                            [/message]
                            [message]
                                speaker=Rashti
                                #image="wesnoth-icon.png"
                                message= _ "No, you are wrong."
                            [/message]
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "You will see..."
                            [/message]
                        [/case]
                        [case]
                            value=5
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "Evil Rashti'rhami, I speak to you!"
                            [/message]
                            [message]
                                speaker=Rashti
                                image="portraits/rashti-dharma.png"
                                message= _ "So SHUT UP!!"
                            [/message]
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "Hahaha..."
                            [/message]
                        [/case]
                        [case]
                            value=10
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "YOU FOOL! YOU SERVE PEOPLE, INSTEAD OF SLAVING THEM. YOU'RE A PITY!!!"
                            [/message]
                            [message]
                                speaker=Rashti
                                image="portraits/rashti-dharma.png"
                                message= _ "HOW DARE YOU!!! I WILL BITE YOUR HEAD OFF!!!"
                            [/message]
                            [message]
                                speaker=Reficul
                                #image="wesnoth-icon.png"
                                message= _ "Itshar'Imahr YOU BELONG TO ME!"
                            [/message]
                            [message]
                                speaker=Rashti
                                #image="wesnoth-icon.png"
                                message= _ "..."
                            [/message]
                            [message]
                                speaker=Mehir
                                #image="wesnoth-icon.png"
                                message= _ "Rashti! Is everything alright?"
                            [/message]
                            [message]
                                speaker=Rashti
                                image="portraits/rashti-dharma.png"
                                message= _ "I HATE YOU!!! I WILL BURN YOU, AND YOU'LL SUFFER!"
                            [/message]
                            {MODIFY_UNIT id=Rashti side 2}
                            [if]
                                [have_unit]
                                    id=Banisher
                                [/have_unit]
                                [then]
                                    [message]
                                        speaker=Banisher
                                        #image="wesnoth-icon.png"
                                        message= _ "It happened... Evil DharmaRashti took control over HoRashti. We must kill this Efreet as soon as possible. This will save her."
                                    [/message]
                                [/then]
                                [else]
                                    [message]
                                        speaker=Mehir
                                        #image="wesnoth-icon.png"
                                        message= _ "Oh no. We must kill that bastard. Maybe there is a chance..."
                                    [/message]
                                [/else]
                            [/if]
                        [/case]
                    [/switch]
                [/then]
            [/if]
[/event]

#Rashti
[event]
    name=recall
    [filter]
        id=Rashti
    [/filter]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "I feel you, Rashti. It is a pleasure for me to have you as a guest in my land."
    [/message]
    [message]
            speaker=Rashti
            #image="wesnoth-icon.png"
            message= _ "You are nothing to me."
    [/message]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "We will see."
    [/message]
    {VARIABLE turn_rashti $turn_number}
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Let's hope, Rashti will resist his will..."
    [/message]
[/event]

[event]
    name=attack
    [filter_second]
        id=Reficul
    [/filter_second]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "Who dares to stand in MY WAY!"
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "He's too powerful for us to banish him! We must kill him!"
    [/message]
[/event]
#Reficul dies
[event]
    name=die
    [filter]
        id=Reficul
    [/filter]
    [message]
            speaker=Reficul
            #image="wesnoth-icon.png"
            message= _ "NOOOOOOOOOOOAAAAAAAARRRRRRRRGGGGHHHHHHHHH!!!."
    [/message]
    {REMOVE_IMAGE 26 3}
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "The enchantment has been dispelled, and the magical entities have regained their personalities."
    [/message]  
    
    [if]
    [have_unit]
        id=Rashti
        side=2
    [/have_unit]
    [then]
    {MODIFY_UNIT (id=Rashti) side 1}
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Rashti, do you recognize me?"
    [/message]
    [message]
            speaker=Rashti
            #image="wesnoth-icon.png"
            message= _ "..."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Please, be as you were before."
    [/message]
    [message]
            speaker=Rashti
            image="portraits/rashti-ho.png"
            message= _ "...I had a vision..."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Wh...what?"
    [/message]
    [message]
            speaker=Rashti
            image="portraits/rashti-ho.png"
            message= _ "...I felt like there was no good nor evil in me. I was Unity..."
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Amazing... an entity from Abyss that has visions... It's the first time I have seen something like this. It looks like she regained her consciousness like others, and luckily so!"
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Thank Nomolas! You're back! I have made a mistake summoning you. Now everything's back to normal, we can finally go back to the city."
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "In accordance to the regulations the local guild will confiscate all of magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "I think, though, it wouldn't be necessary for Rashti, because of her dual nature. Good HoRashti should draw her conclusions for the future and never betray you in similar situations again."
    [/message]
    [/then]
    [else]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "In accordance to the regulations the local guild will confiscate all of magical beings that have betrayed their masters. They will be sent back to the Abyss, where their minds will be cleared."
    [/message]
    [/else]
    [/if]
    
    [if]
    [have_unit]
        id=Banisher
    [/have_unit]
    [then]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "I understand. Your knowledge has proved to be most helpful, so I've decided to allow you to have some of my luxuries!"
    [/message]
    [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Oh, my liege! I am extremely honored! Let's return to the city!"
    [/message]
    [/then]
    [/if]
    
    [if]
    [have_unit]
        id=Rashti
    [/have_unit]
    [then]
    [message]
            speaker=Rashti
            #image="wesnoth-icon.png"
            message= _ "...Someone is coming... I hear their breath - it is a human... they come from the north-west..."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "A human! Alone?! We're on the Great Desert!"
    [/message]
    [/then]
    [/if]
    {UNIT 3 (I8 Kharos_SunMasterofsun) 1 1 (name=Unknown
    id=Unknown)}
    [message]
            speaker=Unknown
            #image="wesnoth-icon.png"
            message= _ "...I've finally found... you..."
    [/message]
    [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "He must've fainted. Quick, give him something to drink. We must bring him to Tar-Tabar!"
    [/message]
    [endlevel]
        name=victory
        linger_mode=no
        carryover_report=no
    [/endlevel]
[/event]

#dispellers limit
[event]
    name=recruit
    first_time_only=no
    [filter]
        type=I8 Ak_Dispeller
        side=1
    [/filter]
    
    [if]
    [have_unit]
        type=I8 Ak_Dispeller
        count=5
        side=1
    [/have_unit]
    [then]
        [disallow_recruit]
            type=I8 Ak_Dispeller
        [/disallow_recruit]
        [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Only five?! I thought Tar-Tabar had more dispellers than that..."
        [/message]
        [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Unfortunately, Tashkar stinted our guild. Forgive me, my liege, but we can't afford to train more of them."
        [/message]
        [message]
            speaker=Mehir
            #image="wesnoth-icon.png"
            message= _ "Excellent, we're fighting with the biggest evil from the Abyss and I have only five dispellers... If we survive this madness, I will remove his limitations."
        [/message]
        [message]
            speaker=Banisher
            #image="wesnoth-icon.png"
            message= _ "Your goodness is unmeasured! Thank you!"
        [/message]
    [/then]
    [/if]
[/event]

[event]
    name=recall
    first_time_only=no
    [filter]
        type=I8 Ak_SummonerIII_lock
    [/filter]
    [object]
                [filter]
                     x,y=$x1,$y1
                [/filter]
                [effect]
                    apply_to=type
                    name=I8 Ak_SummonerIII                 
                [/effect]
                silent=yes
    [/object]
    [unstore_unit]
        variable=unit
        find_vacant=no
    [/unstore_unit]
[/event]
{COLLAR_EVENT}
{DEATH_MEHIR}
{DEATH_RASHTI}
[/scenario]
